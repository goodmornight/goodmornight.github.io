<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><meta name="description" content="SQLServer学习(7)C语言txt文本插入数据库 [ GoodNight ] "><meta name="theme-color" content="#ebc65a"><title>SQLServer学习(7)C语言txt文本插入数据库 [ GoodNight ] </title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.bootcss.com/highlight.js/9.6.0/highlight.min.js" defer></script><script src="/js/paper.js" defer></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-171806323-1" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-171806323-1');</script><link rel="stylesheet" href="/css/tocbot.css"><script src="/js/tocbot.js" defer></script><script>window.addEventListener('DOMContentLoaded', () => {
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.toc__content',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.article__content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // For headings inside relative or absolute positioned containers within content.
    hasInnerContainers: true,
    orderedList: false,
    collapseDepth: 2,
  });
})</script><link rel="preload" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css"><link rel="preload" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap"><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="mask-border"></div><div class="head"><div class="head__inner"><h1><a href="/">GoodNight</a></h1><p>Take A Rest</p></div></div><div class="paper-container"><div class="main"><div class="location-bar"><div class="line-1"><div class="horizontal-line" style="height: 3px"></div></div><div class="line-2"><div class="horizontal-line" style="height: 1px"></div></div><p class="text">SQLServer学习(7)C语言txt文本插入数据库</p><div class="switch-button"><input class="container_toggle" type="checkbox" id="switch" name="mode"><label for="switch">Toggle</label></div><div class="line-3"><div class="horizontal-line" style="height: 1px"></div></div></div><div class="main__2-col"><article class="post-view__article"><div class="article__infomation"><div class="posts-item"><h2 class="posts-item__title"><a href="">SQLServer学习(7)C语言txt文本插入数据库</a></h2><span class="post__date">2019-06-07</span><a href="/tags/SQL-Server/"><span class="post__tags">#SQL Server</span></a><a href="/tags/C/"><span class="post__tags">#C</span></a></div></div><div class="article__content"><p>之前我的一些有关于SQLServer学习的文章：</p>
<p><a href="http://spyxxx.xyz/2019/04/10/SQLServer%E5%AD%A6%E4%B9%A0-1-%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AE%89%E8%A3%85/" target="_blank" rel="noopener">SQL Server学习(1)介绍与安装</a></p>
<p><a href="http://spyxxx.xyz/2019/04/23/SQLServer%E5%AD%A6%E4%B9%A0-2-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E6%95%B0%E6%8D%AE%E8%A1%A8/" target="_blank" rel="noopener">SQL Server学习(2)创建数据库和数据表</a></p>
<p><a href="http://www.spyxxx.xyz/2019/05/06/SQLServer%E5%AD%A6%E4%B9%A0-3-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E8%A1%A8/" target="_blank" rel="noopener">SQLServer学习(3)导入导出数据表</a></p>
<p><a href="http://www.spyxxx.xyz/2019/05/14/SQLServer%E5%AD%A6%E4%B9%A0-4-%E7%BB%99%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E8%A1%A8%E7%94%9F%E6%88%90SQL%E8%84%9A%E6%9C%AC/" target="_blank" rel="noopener">SQLServer学习(4)给数据库、表生成SQL脚本</a></p>
<p><a href="http://www.spyxxx.xyz/2019/05/29/SQLServer%E5%AD%A6%E4%B9%A0-5-%E4%B8%BASQLServer%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E8%B4%A6%E6%88%B7/" target="_blank" rel="noopener">SQLServer学习(5)为SQLServer创建登录账户</a></p>
<p><a href="http://www.spyxxx.xyz/2019/05/29/SQLServer%E5%AD%A6%E4%B9%A0-6-C%E8%AF%AD%E8%A8%80%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/" target="_blank" rel="noopener">SQLServer学习(6)C语言连接数据库</a></p>
<p>我的配置：</p>
<ul>
<li>操作系统：Window10 x64</li>
<li>SQL Server 2016</li>
<li>IDE：Visual Studio 2017</li>
</ul>
<p>这篇文章将介绍如何用C语言将TXT文本数据插入SQLServer数据库。</p>
<hr>
<h1 id="读取TXT文件内容"><a href="#读取TXT文件内容" class="headerlink" title="读取TXT文件内容"></a>读取TXT文件内容</h1><p>首先，抛开SQLServer数据库，单纯地用C语言实现读取TXT格式文本内容。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_LINE 1024</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">data</span> &#123;</span><br>	<span class="hljs-keyword">int</span> id;<br>	<span class="hljs-keyword">char</span> name[<span class="hljs-number">10</span>];<br>&#125;person[<span class="hljs-number">1000</span>];<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">char</span> buf[MAX_LINE];  <span class="hljs-comment">/*缓冲区*/</span><br>	FILE *fp;            <span class="hljs-comment">/*文件指针*/</span><br>	<span class="hljs-keyword">int</span> len;             <span class="hljs-comment">/*行字符个数*/</span><br>	<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span> ((fp = fopen(<span class="hljs-string">"D:\\vs_project\\WriteTXT\\WriteTXT\\WriteTXT\\test.txt"</span>, <span class="hljs-string">"r"</span>)) == <span class="hljs-literal">NULL</span>)<br>	&#123; <span class="hljs-comment">//如果打开文件错误，报错，退出</span><br>		perror(<span class="hljs-string">"fail to read"</span>); <br>		<span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"id\tname\n"</span>);<br>	<span class="hljs-keyword">while</span>(fgets(buf, MAX_LINE, fp) != <span class="hljs-literal">NULL</span>)<br>	&#123;<br>		len = <span class="hljs-built_in">strlen</span>(buf);<br>		buf[len - <span class="hljs-number">1</span>] = <span class="hljs-string">'\0'</span>;  <span class="hljs-comment">/*去掉换行符*/</span><br>		<br>		<span class="hljs-built_in">sscanf</span>(buf,<span class="hljs-string">"%d,%s"</span>, &amp;person[i].id, &amp;person[i].name);<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\t%s\n"</span>, person[i].id, person[i].name);<br>		i++;	<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"num:%d\n"</span>, i);<br>	getchar(); <br>	<span class="hljs-comment">//关闭文件 </span><br>	fclose(fp);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h2><h3 id="perror-函数"><a href="#perror-函数" class="headerlink" title="perror()函数"></a>perror()函数</h3><p><code>void perror(const char *str)</code> 把一个描述性错误消息输出到标准错误 stderr。首先输出字符串 <strong>str</strong>，后跟一个冒号，然后是一个空格。</p>
<h3 id="exit-函数"><a href="#exit-函数" class="headerlink" title="exit()函数"></a>exit()函数</h3><p><code>void exit(int status)</code> 立即终止调用进程。任何属于该进程的打开的文件描述符都会被关闭，该进程的子进程由进程 1 继承，初始化，且会向父进程发送一个 SIGCHLD 信号。</p>
<h3 id="fopen-函数"><a href="#fopen-函数" class="headerlink" title="fopen()函数"></a>fopen()函数</h3><p> <code>FILE *fopen(const char *filename, const char *mode)</code> 使用给定的模式 mode 打开 filename 所指向的文件。</p>
<ul>
<li><p><strong>filename</strong> – 这是 C 字符串，包含了要打开的文件名称。</p>
</li>
<li><p><strong>mode</strong> – 这是 C 字符串，包含了文件访问模式，模式有：<code>r</code>、<code>w</code>、<code>a</code>、<code>r+</code>、<code>w+</code>、<code>a+</code>。</p>
</li>
</ul>
<p>该函数返回一个 FILE 指针。否则返回 NULL，且设置全局变量 errno 来标识错误。</p>
<h3 id="fgets-函数"><a href="#fgets-函数" class="headerlink" title="fgets()函数"></a>fgets()函数</h3><p><code>char *fgets(char *str, int n, FILE *stream)</code> 从指定的流 stream 读取一行，并把它存储在 str 所指向的字符串内。当读取 (n-1) 个字符时，或者读取到换行符时，或者到达文件末尾时，它会停止，具体视情况而定。</p>
<ul>
<li><strong>str</strong> – 这是指向一个字符数组的指针，该数组存储了要读取的字符串。</li>
<li><strong>n</strong> – 这是要读取的最大字符数（包括最后的空字符）。通常是使用以 str 传递的数组长度。</li>
<li><strong>stream</strong> – 这是指向 FILE 对象的指针，该 FILE 对象标识了要从中读取字符的流。</li>
</ul>
<h3 id="sscanf-函数"><a href="#sscanf-函数" class="headerlink" title="sscanf()函数"></a>sscanf()函数</h3><p><code>int sscanf(const char *str, const char *format, ...)</code> 从字符串读取格式化输入。</p>
<h3 id="fscanf-函数"><a href="#fscanf-函数" class="headerlink" title="fscanf()函数"></a>fscanf()函数</h3><p>与<code>sscanf()</code>函数类似，<code>int fscanf(FILE *stream, const char *format, ...)</code> 从流 stream 读取格式化输入。fscanf能正确操作的txt文件编码方式为ANSI，以下编码方式均不能使函数正常执行：<del>UTF-8，Unicode，Unicode big endian</del>。</p>
<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><p>VS使用fopen()时可能会报如图错误“error C4996: ‘fopen’: This function or variable may be unsafe. Consider using fopen_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS. See online help for details.”：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_1.png?raw=true" alt=""></p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>（1）在VS中，<strong>在“解决方案资源管理器”中项目名上单击右键——选择“属性”。</strong></p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_2.png?raw=true" alt=""></p>
<p>（2）<strong>在属性页中的“预处理器”中添加预处理定义。</strong></p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_3.png?raw=true" alt=""></p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_4.png?raw=true" alt=""></p>
<p>（3）<strong>把 _CRT_SECURE_NO_WARNINGS添加进去，确定保存</strong>即可，再次运行就没有问题了。</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_5.png?raw=true" alt=""></p>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>TXT文本文件里的内容，如图：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_6.png?raw=true" alt=""></p>
<p>程序运行效果如图：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_7.png?raw=true" alt=""></p>
<h1 id="插入数据库"><a href="#插入数据库" class="headerlink" title="插入数据库"></a>插入数据库</h1><p>结合上一篇文章<a href="http://www.spyxxx.xyz/2019/05/29/SQLServer%E5%AD%A6%E4%B9%A0-6-C%E8%AF%AD%E8%A8%80%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/" target="_blank" rel="noopener">SQLServer学习(6)C语言连接数据库</a>将部分代码修改写成<code>void insertData(int i)</code>函数，然后和上文读取TXT文本的代码写成<code>int readTxt(char path[1024])</code>函数相结合即可。</p>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;     </span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;     </span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sql.h&gt;     </span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sqlext.h&gt;     </span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sqltypes.h&gt;     </span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;odbcss.h&gt;  </span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_LINE 1024</span><br><br>SQLINTEGER id;<br>SQLCHAR name[<span class="hljs-number">20</span>];<br>SQLINTEGER len_id, len_name;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">data</span> &#123;</span><br>	<span class="hljs-keyword">int</span> id;<br>	<span class="hljs-keyword">char</span> name[<span class="hljs-number">10</span>];<br>&#125;person[<span class="hljs-number">1000</span>];<br><br><span class="hljs-comment">/*读取txt文件*/</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">readTxt</span><span class="hljs-params">(<span class="hljs-keyword">char</span> path[<span class="hljs-number">1024</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-keyword">char</span> buf[MAX_LINE];  <span class="hljs-comment">//缓冲区</span><br>	FILE *fp;            <span class="hljs-comment">//文件指针</span><br>	<span class="hljs-keyword">int</span> len;             <span class="hljs-comment">//行字符个数</span><br>	<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span> ((fp = fopen(path, <span class="hljs-string">"r"</span>)) == <span class="hljs-literal">NULL</span>)<br>	&#123;<br>		perror(<span class="hljs-string">"fail to read"</span>);<br>		<span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"id\tname\n"</span>);<br>	<span class="hljs-keyword">while</span> (fgets(buf, MAX_LINE, fp) != <span class="hljs-literal">NULL</span>)<br>	&#123;<br>		len = <span class="hljs-built_in">strlen</span>(buf);<br>		buf[len - <span class="hljs-number">1</span>] = <span class="hljs-string">'\0'</span>;  <span class="hljs-comment">//去掉换行符</span><br>		<span class="hljs-built_in">sscanf</span>(buf, <span class="hljs-string">"%d,%s"</span>, &amp;person[i].id, &amp;person[i].name);<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\t%s\n"</span>, person[i].id, person[i].name);<br>		i++;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"num:%d\n"</span>, i);<br>	<span class="hljs-comment">//关闭文件 </span><br>	fclose(fp);<br>	<span class="hljs-keyword">return</span> i;<br>&#125;<br><span class="hljs-comment">/*插入数据*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertData</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;<br>	SQLRETURN retcode;<br>	SQLHENV henv;<br>	SQLHDBC hdbc;<br>	SQLHSTMT hstmt;<br><br>	retcode = SQLAllocHandle(SQL_HANDLE_ENV, <span class="hljs-literal">NULL</span>, &amp;henv); <span class="hljs-comment">//申请环境句柄</span><br>	retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION,<br>		(SQLPOINTER)SQL_OV_ODBC3,<br>		SQL_IS_INTEGER); <span class="hljs-comment">//设置环境属性</span><br>	retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &amp;hdbc); <span class="hljs-comment">//申请数据库连接句柄</span><br>	retcode = SQLConnect(hdbc, (SQLCHAR*)<span class="hljs-string">"SQLC"</span>, SQL_NTS, (SQLCHAR*)<span class="hljs-string">"SQLC"</span>, SQL_NTS, (SQLCHAR*)<span class="hljs-string">"SQLC123"</span>, SQL_NTS);<br>	<span class="hljs-keyword">if</span> ((retcode == SQL_SUCCESS) || (retcode == SQL_SUCCESS_WITH_INFO)) &#123; <span class="hljs-comment">//判断是否成功执行</span><br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"insertDataBase success!\n"</span>);<br>		retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &amp;hstmt);<span class="hljs-comment">//申请SQL语句句柄 </span><br>		SQLCHAR sql[] = <span class="hljs-string">"USE test2"</span>;<br>		retcode = SQLExecDirect(hstmt, sql, SQL_NTS);<span class="hljs-comment">//直接执行SQL语句</span><br>		SQLCHAR sql1[] = <span class="hljs-string">"INSERT INTO test VALUES (?,?);"</span>;<br>		SQLINTEGER P = SQL_NTS;<br>		retcode = SQLPrepare(hstmt, sql1, SQL_NTS);<br>		retcode = SQLBindParameter(hstmt, <span class="hljs-number">1</span>, SQL_PARAM_INPUT, SQL_C_LONG, SQL_INTEGER, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, &amp;person[i].id, <span class="hljs-number">0</span>, &amp;P);<br>		retcode = SQLBindParameter(hstmt, <span class="hljs-number">2</span>, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, &amp;person[i].name, <span class="hljs-number">20</span>, &amp;P);<br>		retcode = SQLExecute(hstmt);<span class="hljs-comment">//执行插入SQL语句，前面可以用结构体加入问号内容</span><br>		<span class="hljs-keyword">if</span> (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) &#123;<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"insertData%d success!\n"</span>,i);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"insertData wrong!\n"</span>);<br>			SQLDisconnect(hdbc);<span class="hljs-comment">//断开与数据库的连接 </span><br>		&#125;<br><br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"insertDatabase wrong!\n"</span>);<br>		SQLDisconnect(hdbc);<span class="hljs-comment">//断开与数据库的连接 </span><br>	&#125;<br>	SQLFreeHandle(SQL_HANDLE_DBC, hdbc);<span class="hljs-comment">//释放连接句柄 </span><br>	SQLFreeHandle(SQL_HANDLE_ENV, henv);<span class="hljs-comment">//释放环境句柄</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">int</span> num;<br>	<span class="hljs-keyword">int</span> i;<br>	<span class="hljs-keyword">char</span> path[]=<span class="hljs-string">"D:\\vs_project\\WriteTXT\\WriteTXT\\WriteTXT\\test.txt"</span>;<br>	num = readTxt(path);<br>	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; num; i++) &#123;<br>		insertData(i);<br>	&#125;<br>	getchar();<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="相关函数-1"><a href="#相关函数-1" class="headerlink" title="相关函数"></a>相关函数</h2><p>SQL Server Native Client ODBC 驱动程序基于准备好的 SQL 语句创建临时存储过程。存储过程是多次执行某个语句的有效方式，不过创建存储过程的开销要比执行简单语句高。一般规则是，如果应用程序将要提交 SQL 语句超过三次，需要考虑使用 <strong>SQLPrepare</strong> 和 <strong>SQLExecute</strong>。在调用 <strong>SQLPrepare</strong> 之前使用 <strong>SQLBindParameter</strong> 绑定参数变量。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-function">SQLRETURN <span class="hljs-title">SQLBindParameter</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">      SQLHSTMT        StatementHandle,     <span class="hljs-comment">// statement句柄</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLUSMALLINT    ParameterNumber,    <span class="hljs-comment">// 参数位于语句中的序号，最小为1</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLSMALLINT     InputOutputType,    <span class="hljs-comment">// 入参/出参类型标识</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLSMALLINT     ValueType,          <span class="hljs-comment">// 对应的C数据类型标识</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLSMALLINT     ParameterType,     <span class="hljs-comment">// 对应的SQL数据类型标识</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLULEN         ColumnSize,          <span class="hljs-comment">// 对应字段长度</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLSMALLINT     DecimalDigits,       <span class="hljs-comment">// 如果是浮点数，则对应字段精度</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLPOINTER      ParameterValuePtr,   <span class="hljs-comment">// 参数缓存</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLLEN          BufferLength,        <span class="hljs-comment">// 参数缓存字节数</span></span></span><br><span class="hljs-function"><span class="hljs-params">      SQLLEN *        StrLen_or_IndPtr)</span></span>;   <span class="hljs-comment">// 用于表示字符串长度或NULL值的标识</span><br></code></pre></td></tr></table></figure>

<h2 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h2><p>TXT文本内容为：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_9.png?raw=true" alt=""></p>
<p>原数据库test表格中的内容为：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_8.png?raw=true" alt=""></p>
<p>程序效果图：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_10.png?raw=true" alt=""></p>
<p>程序执行后的test表格中的内容为：</p>
<p><img src="https://github.com/SPY-xxx/MyImagesOnline/blob/master/SQLServer/SQLfigure-7_11.png?raw=true" alt=""></p>
<hr>
<p>参考连接：</p>
<p><a href="https://www.runoob.com/cprogramming/c-function-perror.html" target="_blank" rel="noopener">菜鸟教程 - C 库函数 - perror()</a></p>
<p><a href="https://www.runoob.com/cprogramming/c-function-exit.html" target="_blank" rel="noopener">菜鸟教程 - C 库函数 - exit()</a></p>
<p><a href="https://www.runoob.com/cprogramming/c-function-fopen.html" target="_blank" rel="noopener">菜鸟教程 - C 库函数 - fopen()</a></p>
<p><a href="https://www.runoob.com/cprogramming/c-function-fgets.html" target="_blank" rel="noopener">菜鸟教程 - C 库函数 - fgets()</a></p>
<p><a href="https://jingyan.baidu.com/article/ce436649fd61543773afd32e.html" target="_blank" rel="noopener">百度经验 - VS2013中如何解决error C4996: ‘fopen’问题</a></p>
<p><a href="https://docs.microsoft.com/zh-cn/previous-versions/sql/sql-server-2008-r2/ms131462(v=sql.105)" target="_blank" rel="noopener">Microsoft Docs - SQLBindParameter</a></p>
<p><a href="https://blog.csdn.net/u013187074/article/details/52895801" target="_blank" rel="noopener">CSDN博客 - SQLBindParameter 函数的参数解析及使用方法</a></p>
<hr>
<p>初学，可能写的一些地方不对，欢迎指出。</p>
<p>如有问题，可以在评论区里讨论。如需转载，请注明出处，谢谢。</p>
</div></article><div class="post-view__sidebar"><div class="sidebar"><div class="tocbot"><h2>Toc</h2><div class="toc__content"></div></div><h2>Links</h2><div class="sidebar__link"><ul><li><a href="https://github.com/GoodNight-Git" target="_blank" rel="noopener">Github</a></li><li><a href="https://juejin.im/user/5cb1ed9b5188251b090acc5c" target="_blank" rel="noopener">掘金</a></li><li><a href="mailto:goodnightlilanhui@gmail.com">Mail</a></li></ul></div><h2>Archives</h2><div class="sidebar__archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a></li></ul></div><h2>Categories</h2><div class="sidebar__categories"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/about/">about</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/notes/">notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/plans/">plans</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/projects/">projects</a></li></ul></div><h2>Tags</h2><div class="sidebar__tags"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Axios/" rel="tag">Axios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coding-net/" rel="tag">Coding.net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CodingThinking/" rel="tag">CodingThinking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Color/" rel="tag">Color</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/" rel="tag">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali-2-0/" rel="tag">Kali 2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keycloak/" rel="tag">Keycloak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/" rel="tag">OpenCV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python-Web/" rel="tag">Python Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/" rel="tag">Qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL-Server/" rel="tag">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translation/" rel="tag">Translation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu%E7%B3%BB%E7%BB%9F/" rel="tag">Ubuntu系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VUE/" rel="tag">VUE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Win10/" rel="tag">Win10</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keycloak/" rel="tag">keycloak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/taro/" rel="tag">taro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%A7%E5%93%81/" rel="tag">产品</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E6%8E%A8/" rel="tag">内推</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E5%BA%8A/" rel="tag">图床</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%92%E6%AD%A6%E7%BA%AA%E9%A1%B9%E7%9B%AE/" rel="tag">寒武纪项目</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BB%BA%E7%AB%99/" rel="tag">建站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9/" rel="tag">杂项</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/" rel="tag">碎碎念</a></li></ul></div></div></div></div><div class="horizontal-line" style="height: 1px"></div><div class="main__bottom"><div class="pre-next"><a class="pre-button" href="/2020/06/26/2020-%E6%88%91%E5%8F%88%E5%9B%9E%E6%9D%A5%E4%BA%86/">2020,我又回来了</a><a class="next-button" href="/2019/05/29/SQLServer%E5%AD%A6%E4%B9%A0-6-C%E8%AF%AD%E8%A8%80%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/">SQLServer学习(6)C语言连接数据库</a></div></div></div></div><div class="footer"><span>©️2019-2020 </span><p>Designed By&nbsp;<strong><a href="https://github.com/random-yang" target="_blank" rel="noopener">RandomYang</a></strong></p><p>Changed By<strong><a href="http://www.goodnight.wiki" target="_blank" rel="noopener">GoodNight</a></strong></p><p>Powered By&nbsp;<strong><a href="https://hexo.io" target="_blank" rel="noopener">hexo</a></strong></p><p><div id="beian"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61019002001135" target="_blank" rel="noopener"><img src="../img/beian.png"><span>陕公网安备 61019002001135号&nbsp;</span></a></div><div id="tengxun"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener">陕ICP备20010639号</a></div></p></div><div class="darkmode-mask" id="darkmode-mask"></div><div class="sidebar__button"></div></body></html>